[gd_scene load_steps=18 format=2]

[ext_resource path="res://scripts/World.gd" type="Script" id=1]
[ext_resource path="res://addons/my_draw_line_3d/MyDrawLine3D.gd" type="Script" id=2]
[ext_resource path="res://scripts/CameraController.gd" type="Script" id=3]
[ext_resource path="res://scripts/InputSystem.gd" type="Script" id=4]
[ext_resource path="res://scenes/units/UnitObject.tscn" type="PackedScene" id=5]
[ext_resource path="res://scenes/level/LevelTest.tscn" type="PackedScene" id=6]
[ext_resource path="res://scripts/visual/BulletEffects.gd" type="Script" id=7]
[ext_resource path="res://scripts/units_manager/UnitsController.gd" type="Script" id=8]
[ext_resource path="res://data/settings/unit/unit_setting0.tres" type="Resource" id=9]
[ext_resource path="res://scenes/battle/Bullet.tscn" type="PackedScene" id=10]
[ext_resource path="res://data/settings/utility ai/ActionReload.tres" type="Resource" id=11]
[ext_resource path="res://scripts/utility_ai/BrainAI.gd" type="Script" id=12]
[ext_resource path="res://data/settings/utility ai/ActionMove.tres" type="Resource" id=13]
[ext_resource path="res://data/settings/utility ai/ActionShoot.tres" type="Resource" id=14]

[sub_resource type="NavigationMesh" id=11]
vertices = PoolVector3Array( 3.3, 0.2, 0.45, 4.05, 0.2, 0.3, 4.05, 0.2, -1.2, -1.2, 0.2, 1.95, 3.15, 0.2, 1.95, 3.3, 0.2, 0.45, 3.3, 0.2, 0.45, 4.05, 0.2, -1.2, -1.2, 0.2, -1.2, -1.2, 0.2, 1.95, 4.05, 0.2, -1.2, 4.05, 0.2, 0.3, 4.5, 0.2, 0.3, 4.05, 0.2, -1.2, 4.5, 0.2, 0.3, 4.8, 0.2, 0.75, 8.1, 0.2, 4.05, 8.55, 0.2, 4.95, 10.2, 0.2, 4.35, 10.2, 0.2, 2.4, 10.2, 0.2, 2.4, 10.95, 0.2, 2.1, 10.95, 0.2, -1.2, 4.95, 0.2, 2.4, 4.65, 0.2, 2.7, 7.2, 0.2, 4.5, 7.35, 0.2, 4.2, 4.8, 0.2, 0.75, 4.95, 0.2, 2.4, 7.35, 0.2, 4.2, 7.35, 0.2, 4.2, 8.1, 0.2, 4.05, 10.2, 0.2, 2.4, 10.95, 0.2, -1.2, 4.05, 0.2, -1.2, 4.8, 0.2, 0.75, 15.45, 0.2, 0.15, 15.9, 0.2, 0.15, 15.9, 0.2, -1.2, 11.85, 0.2, 4.35, 13.2, 0.2, 4.65, 13.5, 0.2, 4.2, 11.85, 0.2, 2.55, 15.15, 0.2, 0.75, 15.45, 0.2, 0.15, 15.9, 0.2, -1.2, 10.95, 0.2, -1.2, 11.4, 0.2, 2.1, 11.85, 0.2, 2.55, 13.5, 0.2, 4.2, 14.55, 0.2, 4.2, 15.15, 0.2, 1.65, 15.15, 0.2, 0.75, 11.85, 0.2, 2.55, 14.55, 0.2, 4.2, 14.85, 0.2, 4.5, 15.45, 0.2, 1.8, 15.15, 0.2, 1.65, 10.95, 0.2, -1.2, 10.95, 0.2, 2.1, 11.4, 0.2, 2.1, 15.9, 0.2, -1.2, 15.9, 0.2, 0.15, 16.8, 0.2, 0.45, 25.2, 0.2, -1.2, 14.85, 0.2, 4.5, 14.85, 0.2, 6.3, 15.75, 0.2, 6.45, 16.95, 0.2, 1.35, 16.5, 0.2, 1.8, 16.5, 0.2, 1.8, 15.45, 0.2, 1.8, 14.85, 0.2, 4.5, 25.2, 0.2, -1.2, 16.8, 0.2, 0.45, 16.95, 0.2, 1.35, 25.2, 0.2, 4.95, 15.75, 0.2, 7.5, 15.15, 0.2, 7.65, 15.15, 0.2, 11.25, 25.2, 0.2, 4.95, 16.95, 0.2, 1.35, 15.75, 0.2, 7.5, 15.15, 0.2, 11.25, 25.2, 0.2, 11.25, 16.95, 0.2, 1.35, 15.75, 0.2, 6.45, 15.75, 0.2, 7.5, -1.2, 0.2, 7.35, -0.9, 0.2, 7.35, -0.6, 0.2, 6.15, -1.2, 0.2, 1.95, 0.6, 0.2, 6.3, 0.9, 0.2, 6.75, 3.45, 0.2, 2.85, 3.15, 0.2, 2.7, 3.15, 0.2, 2.7, 3.15, 0.2, 1.95, -1.2, 0.2, 1.95, -0.6, 0.2, 6.15, 0.6, 0.2, 6.3, 7.95, 0.2, 7.2, 8.1, 0.2, 6.9, 7.65, 0.2, 6.75, 7.5, 0.2, 7.35, 0.9, 0.2, 7.5, 0.45, 0.2, 7.8, -1.2, 0.2, 11.25, 7.95, 0.2, 11.25, 7.5, 0.2, 9.75, -0.75, 0.2, 7.8, -0.9, 0.2, 7.35, -1.2, 0.2, 7.35, -1.2, 0.2, 11.25, 7.95, 0.2, 11.25, 7.95, 0.2, 9.9, 7.5, 0.2, 9.75, 7.5, 0.2, 7.35, 7.65, 0.2, 6.75, 7.2, 0.2, 4.5, 7.5, 0.2, 9.75, 7.5, 0.2, 7.35, 7.2, 0.2, 4.5, 3.45, 0.2, 2.85, 0.9, 0.2, 6.75, 0.9, 0.2, 7.5, 0.45, 0.2, 7.8, -0.75, 0.2, 7.8, -1.2, 0.2, 11.25, 7.2, 0.2, 4.5, 4.65, 0.2, 2.7, 3.45, 0.2, 2.85, 10.8, 1.2, 2.85, 10.8, 1.2, 4.2, 11.25, 1.2, 4.2, 11.25, 1.2, 2.85, 11.25, 1, 3.525, 8.1, 0.2, 6.9, 7.95, 0.2, 7.2, 8.55, 0.2, 7.35, 8.85, 0.2, 6.6, 15.15, 0.2, 11.25, 15.15, 0.2, 7.65, 14.55, 0.2, 7.65, 8.55, 0.2, 9.75, 7.95, 0.2, 9.9, 7.95, 0.2, 11.25, 13.2, 0.2, 4.65, 11.85, 0.2, 4.35, 11.55, 0.2, 4.8, 13.2, 0.2, 6.6, 14.55, 0.2, 7.65, 14.25, 0.2, 6.9, 13.2, 0.2, 6.6, 8.55, 0.2, 9.75, 7.95, 0.2, 11.25, 15.15, 0.2, 11.25, 10.5, 0.2, 4.8, 10.2, 0.2, 4.35, 8.55, 0.2, 4.95, 8.85, 0.2, 6.6, 8.85, 0.2, 6.6, 8.55, 0.2, 7.35, 8.55, 0.2, 9.75, 13.2, 0.2, 6.6, 11.55, 0.2, 4.8, 10.5, 0.2, 4.8, 13.8, 1.2, 4.8, 13.8, 1.2, 6.15, 14.25, 1.2, 6.15, 14.25, 1.2, 4.8, 14.25, 1, 5.475 )
polygons = [ PoolIntArray( 0, 2, 1 ), PoolIntArray( 5, 4, 3 ), PoolIntArray( 7, 6, 8 ), PoolIntArray( 8, 6, 9 ), PoolIntArray( 12, 11, 10 ), PoolIntArray( 13, 15, 14 ), PoolIntArray( 17, 16, 18 ), PoolIntArray( 18, 16, 19 ), PoolIntArray( 22, 21, 20 ), PoolIntArray( 26, 25, 23 ), PoolIntArray( 23, 25, 24 ), PoolIntArray( 29, 28, 27 ), PoolIntArray( 31, 30, 32 ), PoolIntArray( 32, 30, 35 ), PoolIntArray( 32, 35, 34 ), PoolIntArray( 32, 34, 33 ), PoolIntArray( 38, 37, 36 ), PoolIntArray( 40, 39, 41 ), PoolIntArray( 41, 39, 42 ), PoolIntArray( 44, 43, 45 ), PoolIntArray( 45, 43, 48 ), PoolIntArray( 45, 48, 47 ), PoolIntArray( 45, 47, 46 ), PoolIntArray( 49, 53, 50 ), PoolIntArray( 50, 53, 51 ), PoolIntArray( 51, 53, 52 ), PoolIntArray( 57, 56, 54 ), PoolIntArray( 54, 56, 55 ), PoolIntArray( 60, 59, 58 ), PoolIntArray( 62, 61, 63 ), PoolIntArray( 63, 61, 64 ), PoolIntArray( 66, 65, 67 ), PoolIntArray( 67, 65, 69 ), PoolIntArray( 67, 69, 68 ), PoolIntArray( 72, 71, 70 ), PoolIntArray( 74, 73, 75 ), PoolIntArray( 75, 73, 76 ), PoolIntArray( 79, 78, 77 ), PoolIntArray( 82, 81, 83 ), PoolIntArray( 83, 81, 80 ), PoolIntArray( 83, 80, 84 ), PoolIntArray( 87, 86, 85 ), PoolIntArray( 89, 88, 90 ), PoolIntArray( 90, 88, 91 ), PoolIntArray( 95, 94, 92 ), PoolIntArray( 92, 94, 93 ), PoolIntArray( 97, 96, 98 ), PoolIntArray( 98, 96, 100 ), PoolIntArray( 98, 100, 99 ), PoolIntArray( 102, 101, 103 ), PoolIntArray( 103, 101, 104 ), PoolIntArray( 106, 105, 107 ), PoolIntArray( 107, 105, 109 ), PoolIntArray( 107, 109, 108 ), PoolIntArray( 111, 110, 112 ), PoolIntArray( 112, 110, 113 ), PoolIntArray( 116, 115, 114 ), PoolIntArray( 119, 118, 117 ), PoolIntArray( 121, 120, 122 ), PoolIntArray( 122, 120, 123 ), PoolIntArray( 123, 120, 124 ), PoolIntArray( 124, 120, 125 ), PoolIntArray( 128, 127, 126 ), PoolIntArray( 129, 131, 130 ), PoolIntArray( 134, 133, 136 ), PoolIntArray( 136, 133, 135 ), PoolIntArray( 135, 133, 132 ), PoolIntArray( 138, 137, 139 ), PoolIntArray( 139, 137, 140 ), PoolIntArray( 143, 142, 141 ), PoolIntArray( 146, 145, 144 ), PoolIntArray( 148, 147, 149 ), PoolIntArray( 149, 147, 150 ), PoolIntArray( 152, 151, 153 ), PoolIntArray( 153, 151, 156 ), PoolIntArray( 153, 156, 154 ), PoolIntArray( 154, 156, 155 ), PoolIntArray( 158, 157, 159 ), PoolIntArray( 159, 157, 160 ), PoolIntArray( 162, 161, 163 ), PoolIntArray( 163, 161, 166 ), PoolIntArray( 163, 166, 165 ), PoolIntArray( 163, 165, 164 ), PoolIntArray( 169, 168, 171 ), PoolIntArray( 171, 168, 170 ), PoolIntArray( 170, 168, 167 ) ]
geometry_source_geometry_mode = 1
cell_size = 0.15
cell_height = 0.1
agent_radius = 0.3

[sub_resource type="SpatialMaterial" id=9]
albedo_color = Color( 0.286275, 0.690196, 0.788235, 1 )

[sub_resource type="CylinderMesh" id=10]
material = SubResource( 9 )
top_radius = 0.05
bottom_radius = 0.1
height = 0.05
radial_segments = 16

[node name="World" type="Spatial"]
script = ExtResource( 1 )

[node name="UnitsController" type="Spatial" parent="."]
unique_name_in_owner = true
script = ExtResource( 8 )
units_data = [ ExtResource( 9 ), ExtResource( 9 ) ]

[node name="BulletEffects" type="Spatial" parent="UnitsController"]
script = ExtResource( 7 )
bullet_scene = ExtResource( 10 )

[node name="Navigation" type="Navigation" parent="UnitsController"]

[node name="NavigationMeshInstance" type="NavigationMeshInstance" parent="UnitsController/Navigation"]
navmesh = SubResource( 11 )

[node name="LevelTest" parent="UnitsController/Navigation/NavigationMeshInstance" instance=ExtResource( 6 )]

[node name="DrawLine3D" type="MeshInstance" parent="UnitsController"]
unique_name_in_owner = true
skeleton = NodePath("../Navigation/NavigationMeshInstance/LevelTest")
script = ExtResource( 2 )
color = Color( 0.505882, 0.615686, 0.0392157, 1 )

[node name="MousePointer" type="MeshInstance" parent="UnitsController"]
unique_name_in_owner = true
transform = Transform( 1, 0, -2.98023e-08, -2.98023e-08, 1, 0, 0, 0, 1, -100, 3.33786e-06, -100 )
mesh = SubResource( 10 )
skeleton = NodePath("../Navigation/NavigationMeshInstance/LevelTest")

[node name="UnitObjectPlayer" parent="UnitsController" instance=ExtResource( 5 )]
unique_name_in_owner = true
transform = Transform( -4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 5, 0, 5 )

[node name="UnitObjectEnemy" parent="UnitsController" instance=ExtResource( 5 )]
unique_name_in_owner = true
transform = Transform( -0.258819, 0, 0.965926, 0, 1, 0, -0.965926, 0, -0.258819, 15.5355, 0, 5.12132 )
is_player_unit = false

[node name="BrainAI" type="Node" parent="UnitsController"]
unique_name_in_owner = true
script = ExtResource( 12 )
available_actions = [ ExtResource( 13 ), ExtResource( 11 ), ExtResource( 14 ) ]

[node name="InputSystem" type="Spatial" parent="."]
script = ExtResource( 4 )

[node name="CameraController" type="Position3D" parent="InputSystem"]
unique_name_in_owner = true
transform = Transform( 0.707107, 0.5, -0.5, 0, 0.707107, 0.707107, 0.707107, -0.5, 0.5, 1.204, 12.373, 14.583 )
script = ExtResource( 3 )
camera_offset = Vector3( -9, 12, 9 )

[node name="Camera" type="Camera" parent="InputSystem/CameraController"]
unique_name_in_owner = true
current = true
fov = 30.0

[connection signal="on_click_world" from="InputSystem" to="UnitsController" method="_on_InputSystem_on_click_world"]
[connection signal="on_drag" from="InputSystem" to="InputSystem/CameraController" method="_on_InputSystem_on_drag"]
[connection signal="on_mouse_hover" from="InputSystem" to="UnitsController" method="_on_InputSystem_on_mouse_hover"]
[connection signal="on_unit_rotation_pressed" from="InputSystem" to="UnitsController" method="_on_InputSystem_on_unit_rotation_pressed"]
